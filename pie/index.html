<!DOCTYPE html>

<html>
	<head>
		<title></title>
		<style>
			#canvas {
				stroke:white;
				stroke-width:2px;
			}

		</style>
	</head>
	<body>
		<div id="vis-container"></div>
		<script type="text/javascript" src="../js/jquery-1.9.1.min.js"></script>
		<script type="text/javascript" src="../js/d3.min.js"></script>
		<script type="text/javascript">

		// global object
		// reset to clear pie
		var data = [];
		// var data = [{"label":"chicken","value":0.7, "total_loss":20}];
	
		drawPie("meat");



		function drawPie(arg) {

			$("#vis-container").html("");

			d3.json("../stats.json", function(error, json) {

				var color = d3.scale.category20c();

				data.push({
					"label": json[arg].Label,
					"value": json[arg]["Consumer Losses"],
					"total_loss": json[arg]["Total Loss"]
				});


				var r = 300,
					width = 600,
					height = 600;

				var vis = d3.select("#vis-container")
					.append("svg:svg")
					.data([data])
					.attr("width", width)
					.attr("height", height)
					.attr("id", "canvas")
					.append("svg:g")
					.attr("transform", "translate(" + r + "," + r + ")");

				var pie = d3.layout.pie()
					.value(function(d) {
						return d.value;
					});

				var arc = d3.svg.arc()
					.outerRadius(r);

				var arcs = vis.selectAll("g.slice")
					.data(pie)
					.enter()
						.append("svg:g")
						.attr("class", "slice");

				arcs.append("svg:path")
					.attr("fill", function(d, i) { return color(i); })
					.attr("d", arc);


				var arr = [];

				var arcx = d3.svg.arc()
					.innerRadius(0)
					.startAngle(function(d, i) {

							console.log(d["startAngle"])

						return 0;

					})
					.endAngle(function(d, i) {

						var radians = d["endAngle"] - 2 * Math.PI;

						arr.push(radians);

						console.log(d["endAngle"])

						return d["endAngle"] - 6.28;


					});

					spie(arg, "red");


		function spie(arg, color) {

				var arcsy = vis.selectAll("g." + arg)
					.data(pie)
					.enter()
						.append("svg:g")
						.attr("d", function(d) {
								var loss = d.data.total_loss;
								return arcx.outerRadius(loss);
						})
						.attr("class", arg);

				arcsy.append("svg:path")
					.attr("fill", function(d, i) { return color; })
					.attr("d", arcx);

		}



					

			});
		}

		</script>
	</body>
</html>
